{
  "updatedAt": "2026-02-07T16:49:29.985Z",
  "createdAt": "2026-02-05T01:55:52.051Z",
  "id": "VpSYx7huUZoPhUUch0i7-",
  "name": "Deal_Normalization_Canonical",
  "description": null,
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {},
      "id": "d78cbbee-aaa3-49dd-bcd1-8b548f0ee607",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        336,
        176
      ]
    },
    {
      "parameters": {},
      "id": "abbcbbf4-5cbc-436e-8b12-ee5de11c10ca",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        336,
        384
      ]
    },
    {
      "parameters": {
        "jsCode": "// Normalization Logic\n// Inputs: Items with 'source' ('PropStream' | 'Zillow') and raw data\n\nreturn items.map(item => {\n  const json = item.json;\n  const source = json.source || 'Unknown';\n  \n  // Initialize Canonical Object\n  const deal = {\n    source_system: source,\n    last_data_refresh: new Date().toISOString(),\n    properties: {},\n    meta: {}\n  };\n\n  // Helper: Slugify for Key Generation\n  const slugify = (text) => text ? text.toString().toLowerCase().trim().replace(/[^a-z0-9]+/g, '-') : '';\n\n  if (source === 'PropStream') {\n    // --- PROPSTREAM MAPPING ---\n    const address = json['Address'] || '';\n    const zip = json['Zip'] || '';\n    \n    deal.properties = {\n      deal_key: `${slugify(address)}-${zip}`,\n      address: address,\n      city: json['City'],\n      state: json['State'],\n      zip: zip,\n      property_type: json['Property Type'],\n      beds: Number(json['Beds']),\n      baths: Number(json['Baths']),\n      sqft: Number(json['SqFt']),\n      year_built: Number(json['Year Built']),\n      estimated_arv: Number(json['Estimated Value']),\n      equity_amt: Number(json['Equity Amount']),\n      owner_name_1: json['Owner 1 First Name'] + ' ' + json['Owner 1 Last Name'],\n      owner_phone: json['Owner Phone']\n    };\n    \n  } else if (source.includes('Zillow')) {\n    // --- ZILLOW MAPPING ---\n    // Handle both 'Zillow' and 'Zillow Digest'\n    const address = json.address || '';\n    const zip = json.zipcode || '';\n    \n    deal.properties = {\n      deal_key: `${slugify(address)}-${zip}`,\n      address: address,\n      city: json.city,\n      state: json.state,\n      zip: zip,\n      property_type: json.homeType,\n      beds: json.bedrooms,\n      baths: json.bathrooms,\n      sqft: json.livingArea,\n      year_built: json.yearBuilt,\n      estimated_arv: Number(json.price || 0), // Map price to ARV for now\n      list_price: Number(json.price || 0),\n      listing_url: json.listing_url || json.url,\n      listing_status: json.homeStatus,\n      zestimate: json.zestimate,\n      description: json.description\n    };\n  }\n\n  // --- CALCULATED FIELDS ---\n  // Simple MAO (Maximum Allowable Offer) Logic: (ARV * 0.7) - Rehab(est 30k)\n  const arv = deal.properties.estimated_arv || deal.properties.zestimate || 0;\n  if (arv > 0) {\n    deal.properties.mao = (arv * 0.70) - 30000;\n  }\n\n  return { json: deal };\n});"
      },
      "id": "93151091-5021-4cfc-9eab-6bcfadc2b4a3",
      "name": "Normalize to Canonical1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        576,
        176
      ]
    }
  ],
  "connections": {
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Normalize to Canonical1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow Trigger": {
      "main": [
        [
          {
            "node": "Normalize to Canonical1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "e337ce89-df60-4cc1-a3d8-04fb406b1d71",
  "activeVersionId": "e337ce89-df60-4cc1-a3d8-04fb406b1d71",
  "versionCounter": 7,
  "triggerCount": 0,
  "tags": [],
  "shared": [
    {
      "updatedAt": "2026-02-05T01:55:52.051Z",
      "createdAt": "2026-02-05T01:55:52.051Z",
      "role": "workflow:owner",
      "workflowId": "VpSYx7huUZoPhUUch0i7-",
      "projectId": "VNV9rSM2JeXyxIFc",
      "project": {
        "updatedAt": "2026-02-05T00:41:53.983Z",
        "createdAt": "2026-02-05T00:41:35.223Z",
        "id": "VNV9rSM2JeXyxIFc",
        "name": "santi santi <santi.at.the.tower@gmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "creatorId": "47c63571-c0bf-4878-a756-ca8098a5a991"
      }
    }
  ]
}